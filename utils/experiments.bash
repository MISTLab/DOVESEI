#!/bin/bash

# Lat/Lon generated using some coordinates from Paris
# p1 = 48.8810503932738, 2.2926285019834536; p2= 48.837230391660526, 2.389960496086875
# And randomly generating values
# for i in p2[0]+np.random.rand(100)*(p1[0]-p2[0]):
#     print(i, end=" ")
#
# for i in p2[1]+np.random.rand(100)*(p1[1]-p2[1]):
#     print(i, end=" ")

lat=(48.859515960167826 48.87699995601212 48.848154377544006 48.855213372010006 48.870338643770395 48.84725632764148 48.84060365143341 48.849927300794654 48.84429510872809 48.877969744286034 48.872642227996764 48.86498614529267 48.87541779612846 48.87244730336679 48.8454058919419 48.8763423284143 48.86086436957138 48.87261242056244 48.876497113868815 48.85116530444682 48.84205286717087 48.84721851085084 48.85594625564717 48.87307580002293 48.87494760720742 48.83753503403162 48.859611339283454 48.855521342491905 48.846963156273674 48.842482892250466 48.8520246890161 48.878548696407144 48.85139314466309 48.85996379754227 48.86803668357348 48.85316464142342 48.87981388409311 48.87940483367758 48.84826349226979 48.85901982199093 48.8504148796821 48.84971210258367 48.83884677775311 48.86394150175892 48.85925778726938 48.83948619062335 48.84944068017291 48.87703060424887 48.84772799409603 48.84357968518932 48.858678212405515 48.88042159614978 48.84783725404866 48.86668337243219 48.87060456443293 48.84764366922165 48.86914083323151 48.85334664912962 48.86493803417722 48.86499166460813 48.860708039181034 48.84118688952997 48.87383334836482 48.8512869746251 48.84540363308715 48.839017158429236 48.86312332138431 48.86692126308955 48.837957270350906 48.85967031030135 48.8471554368951 48.86550186437711 48.844871128860824 48.86750728445885 48.854177135159325 48.878277901278175 48.84325655965486 48.85217591971378 48.84220280154435 48.87775046750528 48.875675403541074 48.84853339420314 48.86615089362248 48.873041069791746 48.86155929212051 48.86043968085856 48.84782835943796 48.84131015509598 48.876546387621495 48.876686712378046 48.864972898539605 48.85208667765123 48.85253275578342 48.869041770679786 48.876541764698935 48.87610252020294 48.871404539338165 48.86536421943078 48.84091740506235 48.84431296217291)
lon=(2.3025024251075528 2.3309355464279444 2.3890653287131562 2.3800840684749733 2.3253805458084402 2.389467842037801 2.3743087277745243 2.336551142135898 2.3226169567848642 2.3265038066213086 2.3681319169808814 2.320642672314097 2.3668685693015945 2.358288694584382 2.3173029990456726 2.326730430587423 2.307303888104168 2.325953721931164 2.334645886458103 2.3808429441369916 2.3541699837117593 2.364147820799464 2.366212497556206 2.2952554385091433 2.3516995106675416 2.3031358260383987 2.328530515062868 2.3125999269772266 2.3410378255045994 2.3338092905901813 2.3420227668162665 2.370957106749781 2.3196427910642377 2.362632362161378 2.3875937745855498 2.3271353903877166 2.372721960483175 2.298423786700125 2.297112725454974 2.300914920652508 2.3539322116562817 2.3884560727780286 2.29960539922699 2.348284479087676 2.295874054939673 2.296169442158885 2.306935384797163 2.361301198260199 2.3524781662373515 2.3071176665935904 2.3591138453497598 2.3734634290658514 2.335765918892501 2.298842685128368 2.322214528021101 2.3344753056411474 2.3805021141681872 2.3301006163242297 2.293596580586457 2.3763258395418903 2.339510437419379 2.3045640254234825 2.317860009351623 2.322118564094332 2.321586319366494 2.3549705054761216 2.361384616432111 2.311183760874302 2.311110543932858 2.3055666182875965 2.3010729720104433 2.3401905207361127 2.341146915049611 2.312260834434891 2.326698210608977 2.321636660128831 2.3125044086777744 2.303334501405074 2.3570627534732163 2.3534042583551784 2.3808130464724555 2.3336753368133096 2.386462162905627 2.344642912531442 2.3371438117012637 2.362070864624338 2.3324535166530667 2.3869918459396544 2.386325322399763 2.309895143167278 2.3549024227009263 2.377593443018664 2.339129518178669 2.3150154881170084 2.368954205111158 2.329333323967383 2.3816534571273595 2.3849302111068376 2.3382426902202584 2.3373394016182174)

SAVE_DATA="python3 ../save_messages.py folder=."
RUN_EXPERIMENT="ros2 launch ros2_open_voc_landing_heatmap start_aerialview.launch.py "
for i in "${!lat[@]}"; do
    i_plus_one=$((i+1)) # add one to avoid 000
    experiment_folder=$(printf "experiment_%03d" ${i_plus_one}) # create the experiment name
    mkdir ${experiment_folder} # create the directory
    cd ${experiment_folder} # move to the experiment dir
    echo $(printf "lat=%s, lon=%s" "${lat[i]}" "${lon[i]}") > ${experiment_folder}.txt # save the current lat/lon
    $SAVE_DATA & # start the save_messages script in the background
    export init_PID=$! # save the PID from the last command
    printf "${foo} is using lat=%s and lon=%s\n" "${lat[i]}" "${lon[i]}"
    experiment_args=$(printf "savefile:=%s lat:=%s lon:=%s" "${experiment_folder}" "${lat[i]}" "${lon[i]}") # create the experiment name
    $RUN_EXPERIMENT $experiment_args && kill $init_PID
    while $(kill -0 $init_PID 2>/dev/null); do 
        sleep 1
        echo "Waiting for the process to die..."
    done
    echo "Removing the aerialview_cache folder..."
    rm -rf aerialview_cache
    cd ..
done